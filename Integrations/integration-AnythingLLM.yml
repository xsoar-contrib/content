commonfields:
  id: AnythingLLM
  version: -1
name: AnythingLLM
display: AnythingLLM (Community Contribution)
category: Utilities
description: "Retrieval Augmented Generation (RAG) with LLM and Vector DB that can be local for full data privacy or cloud-based for greater functionality.\n\nAPIs are documented at:  <Anything LLM URL> /api/docs \n\nProduct documentation:   https://docs.useanything.com/"
configuration:
- section: Connect
  display: AnythingLLM URL (e.g., http://<url to local AnythingLLM>:3001) or https://<Anything LLM cloud url>
  name: url
  defaultvalue: http://localhost:3001
  type: 0
  required: true
- section: Collect
  display: AnythingLLM API Key
  displaypassword: AnythingLLM API Key
  name: apikey
  type: 9
  required: true
  hiddenusername: true
script:
  script: >
    register_module_line('AnythingLLM', 'start', __line__())

    demisto.debug('pack name = Anything LLM, pack version = 1.0.0')




    import json

    import shutil



    ''' CLIENT CLASS '''

    class Client(BaseClient):
        def test_module(self):
            self._http_request("GET", "/v1/auth")


        def document_list(self):
            return self._list("documents")


        def document_get(self, folder: str, document: str):
            try:
                name = document_name(folder, document, self.document_list())
                response = self._http_request(
                    method = "GET",
                    url_suffix = f"/v1/document/{name}"
                )
            except Exception as e:
                msg = f"AnythingLLM: document_get: exception getting document details - {str(e)}"
                demisto.debug(msg)
                raise Exception(msg)

            return response


        def document_delete(self, folder: str, document: str):
            try:
                name = document_name(folder, document, self.document_list())
                data = {
                    "names": [
                        f"{folder}/{name}"
                    ]
                }
                response = self._http_request(
                    method = "DELETE",
                    url_suffix = "/v1/system/remove-documents",
                    json_data = data
                )
            except Exception as e:
                msg = f"AnythingLLM: document_delete: exception deleting document - {str(e)}"
                demisto.debug(msg)
                raise Exception(msg)

            return {"message": response}


        def document_createfolder(self, folder: str):
            try:
                data = {
                    "name": folder
                }
                response = self._http_request(
                    method = "POST",
                    url_suffix = "/v1/document/create-folder",
                    json_data = data
                )
            except Exception as e:
                msg = f"AnythingLLM: document_createfolder: exception creating folder - {str(e)}"
                demisto.debug(msg)
                raise Exception(msg)

            return response


        def document_move(self, srcfolder: str, dstfolder: str, document: str):
            try:
                name = document_name(srcfolder, document, self.document_list())
                data = {
                    "files": [
                        {
                        "from": f"{srcfolder}/{name}",
                        "to": f"{dstfolder}/{name}"
                        }
                    ]
                }
                response = self._http_request(
                    method = "POST",
                    url_suffix = "/v1/document/move-files",
                    json_data = data
                )
            except Exception as e:
                msg = f"AnythingLLM: document_move: exception moving document - {str(e)}"
                demisto.debug(msg)
                raise Exception(msg)

            return response


        def document_upload_text(self, text: str, title: str, description: str, author: str, source: str):
            try:
                try:
                    exists = False
                    document_name("custom-documents", title, self.document_list())
                    exists = True
                except Exception:
                    data = {
                        "textContent": text,
                        "metadata": {
                            "title": title,
                            "docAuthor": author,
                            "description": description,
                            "docSource": source
                        }
                    }
                    response = self._http_request(
                        method = "POST",
                        url_suffix = "/v1/document/raw-text",
                        json_data = data
                    )
                finally:
                    if exists:  # pylint: disable=E0601
                        raise Exception(f"document already exists [{title}]")
            except Exception as e:
                msg = f"AnythingLLM: document_upload_text: exception uploading text - {str(e)}"
                demisto.debug(msg)
                raise Exception(msg)

            return response  # pylint: disable=E0601


        def document_upload_link(self, link: str, title: str, description: str, author: str, source: str):
            try:
                try:
                    exists = False
                    document_name("custom-documents", title, self.document_list())
                    exists = True
                except Exception:
                    data = {
                        "link": link,
                        "metadata": {
                            "title": title,
                            "docAuthor": author,
                            "description": description,
                            "docSource": source
                        }
                    }
                    response = self._http_request(
                        method = "POST",
                        url_suffix = "/v1/document/raw-text",
                        json_data = data
                    )
                finally:
                    if exists:  # pylint: disable=E0601
                        raise Exception(f"document already exists [{title}]")
            except Exception as e:
                msg = f"AnythingLLM: document_upload_link: exception uploading link [{link}] - {str(e)}"
                demisto.debug(msg)
                raise Exception(msg)

            return response  # pylint: disable=E0601


        def document_upload_file(self, entry_id):
            try:
                headers = self._headers
                del headers['Content-Type']
                file_path = demisto.getFilePath(entry_id)['path']
                file_name = demisto.getFilePath(entry_id)['name']
                try:
                    exists = False
                    document_name("custom-documents", file_name, self.document_list())
                    exists = True
                except Exception:
                    shutil.copy(file_path, file_name)
                    response = self._http_request(
                        method = 'POST',
                        headers = headers,
                        url_suffix = "/v1/document/upload",
                        files = {'file': (file_name, open(file_name, 'rb'))}
                    )
                finally:
                    if exists:  # pylint: disable=E0601
                        raise Exception(f"document already exists [{file_name}]")
            except Exception as e:
                msg = f"AnythingLLM: document_upload_file: exception uploading a file entry [{entry_id}] from the war room - {str(e)}"
                demisto.debug(msg)
                raise Exception(msg)
            finally:
                shutil.rmtree(file_name, ignore_errors=True)

            return response  # pylint: disable=E0601


        def workspace_new(self, workspace: str):
            try:
                if len(workspace.strip()) == 0:
                    raise Exception("workspace parameter is blank")
                try:
                    exists = False
                    workspace_slug(workspace, self.workspace_list())
                    exists = True
                except Exception:
                    data = {
                        'name': workspace
                    }
                    response = self._http_request(
                        method = "POST",
                        url_suffix = "/v1/workspace/new",
                        json_data = data
                    )
                    return response
                finally:
                    if exists:  # pylint: disable=E0601
                        raise Exception("workspace already exists")
            except Exception as e:
                msg = f"AnythingLLM: workspace_new: exception creating a new workspace [{workspace}] - {str(e)}"
                demisto.debug(msg)
                raise Exception(msg)


        def workspace_chat(self, workspace: str, message: str, mode: str):
            return self._chat(workspace, message, mode, "chat")


        def workspace_stream_chat(self, workspace: str, message: str, mode: str):
            return self._chat(workspace, message, mode, "stream-chat")


        def workspace_list(self):
            return self._list("workspaces")


        def workspace_get(self, workspace:str ):
            try:
                slug = workspace_slug(workspace, self.workspace_list())
                response = self._http_request(
                    method = "GET",
                    url_suffix = f"/v1/workspace/{slug}",
                )
            except Exception as e:
                msg = f"AnythingLLM: workspace_get: exception getting workspace details - {str(e)}"
                demisto.debug(msg)
                raise Exception(msg)

            return response


        def workspace_delete(self, workspace:str ):
            try:
                slug = workspace_slug(workspace, self.workspace_list())
                self._http_request(
                    method = "DELETE",
                    url_suffix = f"/v1/workspace/{slug}",
                    resp_type='bytes'
                )
            except Exception as e:
                msg = f"AnythingLLM: workspace_delete: exception deleting workspace - {str(e)}"
                demisto.debug(msg)
                raise Exception(msg)

            return {"message": {"success": True, "message": "Workspace removed successfully"}}


        def workspace_settings(self, workspace:str, settings: dict ):
            try:
                settings = validate_workspace_settings(settings)
                slug = workspace_slug(workspace, self.workspace_list())
                response = self._http_request(
                    method = "POST",
                    url_suffix = f"/v1/workspace/{slug}/update",
                    json_data = settings
                )
            except Exception as e:
                msg = f"AnythingLLM: workspace_settings: exception updating workspace settings - {str(e)}"
                demisto.debug(msg)
                raise Exception(msg)

            return response


        def workspace_add_embedding(self, workspace: str, folder: str, document: str):
            return self._embedding(workspace, folder, document, "adds")


        def workspace_delete_embedding(self, workspace: str, folder: str, document: str):
            return self._embedding(workspace, folder, document, "deletes")


        def workspace_pin(self, workspace:str, folder:str, document:str, status: str):
            try:
                if status.lower() == "true":
                    pinst = True
                elif status.lower() == "false":
                    pinst = False
                else:
                    raise Exception("document pin status of [true] or [false] not passed")
                name = document_name(folder, document, self.document_list())
                data = {
                    "docPath": f"{folder}/{name}",
                    "pinStatus": pinst
                }
                slug = workspace_slug(workspace, self.workspace_list())
                response = self._http_request(
                    method = "POST",
                    url_suffix = f"/v1/workspace/{slug}/update-pin",
                    json_data = data
                )
            except Exception as e:
                msg = f"AnythingLLM: workspace_pin: exception pinning embedded document to workspace - {str(e)}"
                demisto.debug(msg)
                raise Exception(msg)

            return response


        def _chat(self, workspace: str, message: str, mode: str, type: str):
            try:
                data = {
                    'message': message,
                    'mode': validate_chat_mode(mode)
                }
                slug = workspace_slug(workspace, self.workspace_list())
                response = self._http_request(
                    method = "POST",
                    url_suffix = f"/v1/workspace/{slug}/{type}",
                    json_data = data
                )
            except Exception as e:
                msg = f"AnythingLLM: _chat: exception chatting - {str(e)}"
                demisto.debug(msg)
                raise Exception(msg)

            return response


        def _list(self, items: str):
            try:
                response = self._http_request(
                    method="GET",
                    url_suffix=f"/v1/{items}",
                )
            except Exception as e:
                msg = f"AnythingLLM: _list: exception listing {items} - {str(e)}"
                demisto.debug(msg)
                raise Exception(msg)

            return response


        def _embedding(self, workspace: str, folder: str, document: str, action: str):
            try:
                name = document_name(folder, document, self.document_list())

                try:
                    ws = self.workspace_get(workspace)
                except Exception:
                    raise Exception(f"workspace [{workspace}] not found")

                if action == "adds":
                    if embedding_exists(name, ws):
                        raise Exception(f"[{document}] already embedded")
                elif action == "deletes":
                    if not embedding_exists(name, ws):
                        raise Exception(f"[{document}] not embedded")

                data = {
                    action: [f"{folder}/{name}"]
                }
                slug = workspace_slug(workspace, self.workspace_list())
                response = self._http_request(
                    method = "POST",
                    url_suffix = f"/v1/workspace/{slug}/update-embeddings",
                    json_data = data
                )
            except Exception as e:
                msg = f"AnythingLLM: _embedding: exception [{action}] a document embedding - {str(e)}"
                demisto.debug(msg)
                raise Exception(msg)

            return response

    ''' HELPER FUNCTIONS '''


    def embedding_exists(docname: str, ws: dict) -> bool:
        for doc in ws['workspace']['documents']:
            if doc['filename'] == docname:
                return True
        return False


    def workspace_slug(workspace: str, workspaces) -> str:
        for w in workspaces['workspaces']:
            if w['name'] == workspace:
                return w['slug']
        raise Exception(f"workspace name not found [{workspace}]")


    def normal_document_title(title: str):
        title = ' '.join(title.strip().split())
        return title.lower().replace(" ", "-") + ".txt"


    def document_name(folder: str, title: str, documents) -> str:
        for f in documents['localFiles']['items']:
            if f['name'] == folder:
                for d in f['items']:
                    if d['title'] in [title, normal_document_title(title)]:
                        return d['name']
        raise Exception(f"document title not found [{title}]")


    def validate_chat_mode(mode: str):
        if mode not in ['chat', 'query']:
            raise Exception(f"Invalid chat mode [{mode}]")
        return mode


    def validate_workspace_settings(settings: dict):
        new_settings = {}
        if "name" in settings:
            new_settings['name'] = settings['name']
        #if "vectorTag" in settings:
        #    new_settings['vectorTag'] = settings['vectorTag']
        if "openAiTemp" in settings:
            new_settings['openAiTemp'] = float(settings['openAiTemp'])
        if "openAiHistory" in settings:
            new_settings['openAiHistory'] = int(settings['openAiHistory'])
        if "openAiPrompt" in settings:
            new_settings['openAiPrompt'] = settings['openAiPrompt']
        if "similarityThreshold" in settings:
            new_settings['similarityThreshold'] = float(settings['similarityThreshold'])
        #if "chatProvider" in settings:
        #    new_settings['chatProvider'] = settings['chatProvider']
        #if "chatModel" in settings:
        #    new_settings['chatModel'] = settings['chatModel']
        if "topN" in settings:
            new_settings['topN'] = int(settings['topN'])
        if "chatMode" in settings:
            new_settings['chatMode'] = settings['chatMode']
        if "queryRefusalResponse" in settings:
            new_settings['queryRefusalResponse'] = settings['queryRefusalResponse']
        return new_settings


    def DictMarkdown(nested, indent):
        md = ""
        if indent == "":
            indent = "-"
        else:
            indent = "  "+indent
        if isinstance(nested, dict):
            for key, val in nested.items():
                if isinstance(val, dict):
                    md += f"{indent} {key}\n"
                    md += DictMarkdown(val, indent)
                elif isinstance(val, list):
                    md += f"{indent} {key}\n"
                    md += DictMarkdown(val, indent)
                else:
                    md += f"{indent} {key}: {val}\n"
        elif isinstance(nested, list):
            for val in nested:
                md += f"{indent} []\n"
                if isinstance(val, dict):
                    md += DictMarkdown(val, indent)
                elif isinstance(val, list):
                    md += f"{indent} {val}\n"
                    md += DictMarkdown(val, indent)
                else:
                    md += f"  {indent} {val}\n"

        return md


    ''' COMMAND FUNCTIONS '''



    def test_module(client: Client, args: dict) -> str:
        try:
            client.test_module()
        except DemistoException as e:
            if 'Forbidden' in str(e):
                return 'Authorization Error: ensure API Key is correctly set'
            else:
                raise e

        return 'ok'


    def list_command(client: Client, args: dict) -> CommandResults:
        response: dict = {}
        return CommandResults(
            outputs_prefix = 'AnythingLLM.list',
            readable_output = DictMarkdown(response, ""),
            outputs = response
        )


    def settings_command(client: Client, args: dict) -> CommandResults:
        response: dict = {}
        return CommandResults(
            outputs_prefix = 'AnythingLLM.settings',
            readable_output = DictMarkdown(response, ""),
            outputs = response
        )


    def document_list_command(client: Client, args: dict) -> CommandResults:
        response = client.document_list()
        return CommandResults(
            outputs_prefix = 'AnythingLLM.workspace_list',
            readable_output = DictMarkdown(response, ""),
            outputs = response
        )


    def document_createfolder_command(client: Client, args: dict) -> CommandResults:
        response = client.document_createfolder(args['folder'])
        return CommandResults(
            outputs_prefix = 'AnythingLLM.document_createfolder',
            readable_output = DictMarkdown(response, ""),
            outputs = response
        )


    def document_delete_command(client: Client, args: dict) -> CommandResults:
        response = client.document_delete(args['folder'], args['document'])
        return CommandResults(
            outputs_prefix = 'AnythingLLM.document_delete',
            readable_output = DictMarkdown(response, ""),
            outputs = response
        )


    def document_move_command(client: Client, args: dict) -> CommandResults:
        response = client.document_move(args['srcfolder'], args['dstfolder'], args['document'])
        return CommandResults(
            outputs_prefix = 'AnythingLLM.document_move',
            readable_output = DictMarkdown(response, ""),
            outputs = response
        )


    def document_get_command(client: Client, args: dict) -> CommandResults:
        response = client.document_get(args['folder'], args['document'])
        return CommandResults(
            outputs_prefix = 'AnythingLLM.document_move',
            readable_output = DictMarkdown(response, ""),
            outputs = response
        )


    def document_upload_file_command(client: Client, args: dict) -> CommandResults:
        response = client.document_upload_file(args['fileentry'])
        return CommandResults(
            outputs_prefix = 'AnythingLLM.upload_file',
            readable_output = DictMarkdown(response, ""),
            outputs = response
        )


    def document_upload_link_command(client: Client, args: dict) -> CommandResults:
        response = client.document_upload_text(
            args['link'],
            args['title'],
            args['description'],
            args['author'],
            args['source']
        )
        return CommandResults(
            outputs_prefix = 'AnythingLLM.upload_link',
            readable_output = DictMarkdown(response, ""),
            outputs = response
        )


    def document_upload_text_command(client: Client, args: dict) -> CommandResults:
        response = client.document_upload_text(
            args['text'],
            args['title'],
            args['description'],
            args['author'],
            args['source']
        )
        return CommandResults(
            outputs_prefix = 'AnythingLLM.upload_text',
            readable_output = DictMarkdown(response, ""),
            outputs = response
        )


    def workspace_delete_command(client: Client, args: dict) -> CommandResults:
        response = client.workspace_delete(args['workspace'])
        return CommandResults(
            outputs_prefix = 'AnythingLLM.workspace_delete',
            readable_output = DictMarkdown(response, ""),
            outputs = response
        )


    def workspace_get_command(client: Client, args: dict) -> CommandResults:
        response = client.workspace_get(args['workspace'])
        return CommandResults(
            outputs_prefix = 'AnythingLLM.workspace_get',
            readable_output = DictMarkdown(response, ""),
            outputs = response
        )


    def workspace_list_command(client: Client, args: dict) -> CommandResults:
        response = client.workspace_list()
        return CommandResults(
            outputs_prefix = 'AnythingLLM.workspace_list',
            readable_output = DictMarkdown(response, ""),
            outputs = response
        )


    def workspace_new_command(client: Client, args: dict) -> CommandResults:
        #if 'workspace' in args:
        response = client.workspace_new(args['workspace'])
        return CommandResults(
            outputs_prefix ='AnythingLLM.workspace_new',
            readable_output = DictMarkdown(response, ""),
            outputs = response
        )

        #msg = f"AnythingLLM: workspace_new_command: missing command arguments [workspace]"
        #demisto.debug(msg)
        #raise Exception(msg)


    def workspace_chat_command(client: Client, args: dict) -> CommandResults:
        response = client.workspace_chat(args['workspace'], args['message'], args['mode'])
        return CommandResults(
            outputs_prefix ='AnythingLLM.workspace_chat',
            readable_output = DictMarkdown(response, ""),
            outputs = response
        )


    def workspace_stream_chat_command(client: Client, args: dict) -> CommandResults:
        response = client.workspace_stream_chat(args['workspace'], args['message'], args['mode'])
        return CommandResults(
            outputs_prefix = 'AnythingLLM.workspace_stream_chat',
            readable_output = DictMarkdown(response, ""),
            outputs = response
        )


    def workspace_delete_embedding_command(client: Client, args: dict) -> CommandResults:
        response = client.workspace_delete_embedding(args['workspace'], args['folder'], args['document'])
        return CommandResults(
            outputs_prefix = 'AnythingLLM.workspace_delete_embedding',
            readable_output = DictMarkdown(response, ""),
            outputs = response
        )


    def workspace_add_embedding_command(client: Client, args: dict) -> CommandResults:
        response = client.workspace_add_embedding(args['workspace'], args['folder'], args['document'])
        return CommandResults(
            outputs_prefix = 'AnythingLLM.workspace_add_embedding',
            readable_output = DictMarkdown(response, ""),
            outputs = response
        )


    def workspace_pin_command(client: Client, args: dict) -> CommandResults:
        response = client.workspace_pin(args['workspace'], args['folder'], args['document'], args['status'])
        return CommandResults(
            outputs_prefix = 'AnythingLLM.workspace_pin',
            readable_output = DictMarkdown(response, ""),
            outputs = response
        )


    def workspace_settings_command(client: Client, args: dict) -> CommandResults:
        response = client.workspace_settings(args['workspace'], json.loads(args['settings']))
        return CommandResults(
            outputs_prefix = 'AnythingLLM.workspace_settings',
            readable_output = DictMarkdown(response, ""),
            outputs = response
        )


    def main() -> None:  # pragma: no cover
        params = demisto.params()
        args = demisto.args()
        command = demisto.command()

        demisto.debug(f'Command being called is {command}')

        try:
            headers = {
                'accept': "application/json",
                'Authorization': f"Bearer {params.get('apikey')['password']}",
                'Content-Type': "application/json"
            }
            client = Client(
                base_url = params.get('url') + "/api",
                verify = not params.get('insecure', False),
                headers = headers,
                proxy = params.get('proxy', False)
            )

            if command == 'test-module':
                # This is the call made when pressing the integration Test button.
                result = test_module(client, params)
                return_results(result)

            #elif command == "anyllm-list":
            #    return_results(list_command(client, args))
            #elif command == "anyllm-settings":
            #    return_results(settings_command(client, args))

            elif command == "anyllm-document-list":
                return_results(document_list_command(client, args))
            elif command == "anyllm-document-createfolder":
                return_results(document_createfolder_command(client, args))
            elif command == "anyllm-document-get":
                return_results(document_get_command(client, args))
            elif command == "anyllm-document-move":
                return_results(document_move_command(client, args))
            elif command == "anyllm-document-delete":
                return_results(document_delete_command(client, args))
            elif command == "anyllm-document-upload-file":
                return_results(document_upload_file_command(client, args))
            elif command == "anyllm-document-upload-link":
                return_results(document_upload_link_command(client, args))
            elif command == "anyllm-document-upload-text":
                return_results(document_upload_text_command(client, args))

            elif command == "anyllm-workspace-get":
                return_results(workspace_get_command(client, args))
            elif command == "anyllm-workspace-list":
                return_results(workspace_list_command(client, args))
            elif command == "anyllm-workspace-new":
                return_results(workspace_new_command(client, args))
            elif command == "anyllm-workspace-chat":
                return_results(workspace_chat_command(client, args))
            elif command == "anyllm-workspace-stream-chat":
                return_results(workspace_stream_chat_command(client, args))
            elif command == "anyllm-workspace-delete-embedding":
                return_results(workspace_delete_embedding_command(client, args))
            elif command == "anyllm-workspace-add-embedding":
                return_results(workspace_add_embedding_command(client, args))
            elif command == "anyllm-workspace-pin":
                return_results(workspace_pin_command(client, args))
            elif command == "anyllm-workspace-delete":
                return_results(workspace_delete_command(client, args))
            elif command == "anyllm-workspace-settings":
                return_results(workspace_settings_command(client, args))
            else:
                raise NotImplementedError(f'Command {command} is not implemented')
        except Exception as e:
            return_error(f'Failed to execute {command} command.\nError: {str(e)}')


    if __name__ in ('__main__', '__builtin__', 'builtins'):
        main()

    register_module_line('AnythingLLM', 'end', __line__())
  type: python
  commands:
  - name: anyllm-document-upload-file
    arguments:
    - name: fileentry
      required: true
      description: 'XSOAR file entry to upload - example: 181@24789.'
    description: Uploads an XSOAR file entry to the custom-documents folder.
  - name: anyllm-document-upload-link
    arguments:
    - name: link
      required: true
      description: 'Web link to upload - example:  https://unit42.paloaltonetworks.com/darkgate-malware-uses-excel-files".'
    - name: title
      required: true
      description: Document title to use.
    - name: description
      required: true
      description: Description of the content in the document.
    - name: author
      required: true
      description: Who is the author of the document.
    - name: source
      required: true
      description: What is the source of the document.
    description: Uploads a web link to the custom-documents folder.
  - name: anyllm-document-upload-text
    arguments:
    - name: text
      required: true
      description: Raw text content that is the document.
    - name: title
      required: true
      description: Document title to use when uploading.
    - name: description
      description: Description of the  content in the document.
    - name: author
      description: Author of the document.
    - name: source
      description: Source of the document.
    description: Upload text content as a document to the custom-documents folder.
  - name: anyllm-workspace-new
    arguments:
    - name: workspace
      required: true
      description: Name of the workspace to create.
    description: Creates a new workspace in AnythingLLM.
  - name: anyllm-workspace-delete
    arguments:
    - name: workspace
      required: true
      description: Name of the workspace to delete.
    description: Deletes an AnythingLLM workspace.
  - name: anyllm-workspace-list
    arguments: []
    description: List all the workspaces in AnythingLLM.
  - name: anyllm-workspace-get
    arguments:
    - name: workspace
      required: true
      description: Name of the workspace.
    description: Get a specific workspace details.
  - name: anyllm-workspace-settings
    arguments:
    - name: workspace
      required: true
      description: Name of the workspace.
    - name: settings
      required: true
      description: JSON object for the settings.
    description: 'Update workspace settings.  Anything LLM APIs are documented at:   <URL>/api/docs.'
  - name: anyllm-workspace-add-embedding
    arguments:
    - name: workspace
      required: true
      description: Name of the workspace.
    - name: folder
      required: true
      description: Folder name containing the document.
    - name: document
      required: true
      description: Document name to add as an embedding.
    description: Add a document to a workspace and create its vector embedding in the workspace.
  - name: anyllm-workspace-delete-embedding
    arguments:
    - name: workspace
      required: true
      description: Name of the workspace.
    - name: folder
      required: true
      description: Folder the document originated from.
    - name: document
      required: true
      description: Name of the document to have its embedding deleted.
    description: Delete a document embedding from the workspace.
  - name: anyllm-document-createfolder
    arguments:
    - name: folder
      required: true
      description: Name of the folder to create.
    description: Create a new document folder.
  - name: anyllm-document-move
    arguments:
    - name: srcfolder
      required: true
      description: Name of the source folder.
    - name: dstfolder
      description: Name of the destination folder.
    - name: document
      description: Document name to move.
    description: Move a document from a source folder to a destination folder.
  - name: anyllm-document-delete
    arguments:
    - name: folder
      required: true
      description: Name of the folder.
    - name: document
      required: true
      description: Name of the document to delete.
    description: Delete a document.
  - name: anyllm-workspace-chat
    arguments:
    - name: workspace
      required: true
      description: Name of the workspace.
    - name: message
      required: true
      description: Message to send.
    - name: mode
      required: true
      auto: PREDEFINED
      predefined:
      - query
      - chat
      description: Mode to chat, query or chat.
    description: Send a chat message to a workspace (default thread). Query mode is based on embedded documents in chat, whereas chat mode is more general.
  - name: anyllm-workspace-stream-chat
    arguments:
    - name: workspace
      required: true
      description: Name of the workspace.
    - name: message
      required: true
      description: Message to send.
    - name: mode
      required: true
      auto: PREDEFINED
      predefined:
      - query
      - chat
      description: Chat mode, query or chat.
    description: Send a stream chat message to a workspace (default thread). Query mode is based on embedded documents in chat, whereas chat mode is more general.
  - name: anyllm-document-list
    arguments: []
    description: List all document details.
  - name: anyllm-document-get
    arguments:
    - name: folder
      required: true
      description: Folder containing the document.
    - name: document
      required: true
      description: Document name.
    description: Get a specific document details.
  - name: anyllm-workspace-pin
    arguments:
    - name: workspace
      required: true
      description: Workspace name.
    - name: folder
      required: true
      description: Folder the document originated from.
    - name: document
      required: true
      description: Document name.
    - name: status
      required: true
      auto: PREDEFINED
      predefined:
      - 'true'
      - 'false'
      description: Set pin status to true or false.
    description: Set the pinned status of a document embedding.
  dockerimage: demisto/python3:3.11.9.104657
  runonce: false
  subtype: python3
  nativeimage:
  - '8.8'
  - '8.6'
fromversion: 6.10.0
tests:
- No tests (auto formatted)
image: data:image/png;base64,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
detaileddescription: "### Community Contributed Integration\n #### Integration Author: Randy Uhrlaub\n No support or maintenance is provided by the author. Customers are encouraged to engage with the user community for questions and guidance at the [Cortex XSOAR Live Discussions](https://live.paloaltonetworks.com/t5/cortex-xsoar-discussions/bd-p/Cortex_XSOAR_Discussions).\n***\n## AnythingLLM\n- Install AnythingLLM on a Windows/Linux/Mac host\n- In AnythingLLM, generate an API key in AnythingLLM\n- In the integration instance, configure the **url** parameter to the AnythingLLM host\n- In the integration instance, configure the **apikey** parameter\n\n---\n[View Integration Documentation](https://xsoar.pan.dev/docs/reference/integrations/anything-llm)"
